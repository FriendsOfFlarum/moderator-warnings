(()=>{var n={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return n.d(r,{a:r}),r},d:(t,r)=>{for(var a in r)n.o(r,a)&&!n.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:r[a]})},o:(n,t)=>Object.prototype.hasOwnProperty.call(n,t)};(()=>{"use strict";const t=flarum.core.compat["forum/app"];var r=n.n(t);const a=flarum.core.compat["forum/components/NotificationGrid"];var o=n.n(a);const s=flarum.core.compat["common/extend"],e=flarum.core.compat["common/models/User"];var i=n.n(e);const c=flarum.core.compat["common/Model"];var u=n.n(c);const l=flarum.core.compat["forum/utils/PostControls"];var p=n.n(l);const f=flarum.core.compat["forum/utils/UserControls"];var d=n.n(f);const h=flarum.core.compat["common/components/Button"];var g=n.n(h);function w(n,t){return w=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,t){return n.__proto__=t,n},w(n,t)}function v(n,t){n.prototype=Object.create(t.prototype),n.prototype.constructor=n,w(n,t)}const b=flarum.core.compat["common/components/Modal"];var _=n.n(b);const y=flarum.core.compat["common/helpers/username"];var k=n.n(y);const W=flarum.core.compat["common/utils/Stream"];var N=n.n(W),C=function(n){function t(){return n.apply(this,arguments)||this}v(t,n);var r=t.prototype;return r.oninit=function(t){n.prototype.oninit.call(this,t),this.publicComment=N()(""),this.privateComment=N()(""),this.strikes=N()(0)},r.className=function(){return"WarningsModal Modal--large"},r.title=function(){return app.translator.trans("fof-moderator-warnings.forum.warning_modal.heading",{username:k()(this.attrs.user)})},r.content=function(){return m("div",{className:"Modal-body"},m("div",{className:"Form Form--centered"},m("div",{className:"Form-group"},m("div",null,m("label",null,app.translator.trans("fof-moderator-warnings.forum.warning_modal.strikes_heading"),m("input",{type:"number",className:"FormControl",bidi:this.strikes,min:"0",max:"5"})))),m("div",{className:"Form-group"},m("div",null,m("label",null,app.translator.trans("fof-moderator-warnings.forum.warning_modal.public_comment_heading",{username:k()(this.attrs.user)}),m("textarea",{className:"FormControl",bidi:this.publicComment,required:!0,rows:"6"})))),m("div",{className:"Form-group"},m("div",null,m("label",null,app.translator.trans("fof-moderator-warnings.forum.warning_modal.private_comment_heading",{username:k()(this.attrs.user)}),m("textarea",{className:"FormControl",bidi:this.privateComment,rows:"6"})))),m("div",{className:"Form-group"},m(g(),{className:"Button Button--primary Button--block",type:"submit",loading:this.loading},app.translator.trans("fof-moderator-warnings.forum.warning_modal.submit_button")))))},r.onsubmit=function(n){n.preventDefault(),app.alerts.dismiss(this.successAlert),this.loading=!0,this.strikes()||this.strikes(0);var t={userId:this.attrs.user.id(),strikes:this.strikes(),public_comment:this.publicComment(),private_comment:this.privateComment()};this.attrs.post&&(t.post=this.attrs.post),app.store.createRecord("warnings").save(t).then(this.hide.bind(this)).then(this.successAlert=app.alerts.show({type:"success"},app.translator.trans("fof-moderator-warnings.forum.warning_modal.confirmation_message"))).then(this.attrs.callback).catch(function(){})},t}(_());const P=flarum.core.compat["forum/components/UserPage"];var A=n.n(P);const L=flarum.core.compat["common/components/LinkButton"];var x=n.n(L);function I(){return I=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)({}).hasOwnProperty.call(r,a)&&(n[a]=r[a])}return n},I.apply(null,arguments)}const U=flarum.core.compat["common/Component"];var B=n.n(U);const O=flarum.core.compat["common/components/LoadingIndicator"];var M=n.n(O);const D=flarum.core.compat["common/components/Dropdown"];var j=n.n(D);const F=flarum.core.compat["common/components/Link"];var H=n.n(F);const T=flarum.core.compat["common/helpers/avatar"];var S=n.n(T);const V=flarum.core.compat["common/helpers/humanTime"];var R=n.n(V);const z=flarum.core.compat["common/utils/classList"];var E=n.n(z);const q=flarum.core.compat["forum/components/PostPreview"];var G=n.n(q),J=function(n){function t(){return n.apply(this,arguments)||this}v(t,n);var r=t.prototype;return r.view=function(){return m("div",{className:"WarningPost"},m("ul",{class:"Dropdown-menu PostPreview-preview fade in"},m("li",null,G().component({post:this.attrs.post}))))},r.oncreate=function(t){n.prototype.oncreate.call(this,t),this.$(".PostPreview-preview").show().css("position","relative")},t}(B());const K=flarum.core.compat["common/components/Separator"];var Q=n.n(K);const X=flarum.core.compat["common/utils/ItemList"];var Y=n.n(X);const Z={controls:function(n,t){var r=this,a=new(Y());return["user","moderation","destructive"].forEach(function(o){var s=r[o+"Controls"](n,t).toArray();s.length&&(s.forEach(function(n){return a.add(n.itemName,n)}),a.add(o+"Separator",Q().component()))}),a},userControls:function(n,t){return new(Y())},moderationControls:function(n,t){return new(Y())},destructiveControls:function(n,t){var r=new(Y());return!n.isHidden()&&app.session.user.canManageWarnings()&&r.add("hide",m(g(),{icon:"far fa-trash-alt",onclick:this.hideAction.bind(n)},app.translator.trans("fof-moderator-warnings.forum.warning_controls.delete_button"))),n.isHidden()&&app.session.user.canManageWarnings()&&r.add("restore",m(g(),{icon:"fas fa-reply",onclick:this.restoreAction.bind(n)},app.translator.trans("fof-moderator-warnings.forum.warning_controls.restore_button"))),n.isHidden()&&app.session.user.canDeleteWarnings()&&r.add("delete",m(g(),{icon:"fas fa-times",onclick:this.deleteAction.bind(n)},app.translator.trans("fof-moderator-warnings.forum.warning_controls.delete_forever_button"))),r},hideAction:function(){return this.pushAttributes({hiddenAt:new Date,hiddenUser:app.session.user}),this.save({isHidden:!0}).then(function(){return m.redraw()})},restoreAction:function(){return this.pushAttributes({hiddenAt:null,hiddenUser:null}),this.save({isHidden:!1}).then(function(){return m.redraw()})},deleteAction:function(n){return n&&(n.loading=!0),this.delete().then(function(){}).catch(function(){}).then(function(){n&&(n.loading=!1),location.reload()})}};var nn=function(n){function t(){return n.apply(this,arguments)||this}v(t,n);var r=t.prototype;return r.view=function(){var n=this.attrs.warning,t=n.addedByUser(),r=Z.controls(n,this).toArray();return m("div",this.elementAttrs(),r.length?j().component({icon:"fas fa-ellipsis-v",className:"WarningListItem-controls",buttonClassName:"Button Button--icon Button--flat Slidable-underneath Slidable-underneath--right"},r):"",m("div",{className:"WarningListItem-main"},m("h3",{className:"WarningListItem-title"},m(H(),{href:t?app.route.user(t):"#",className:"WarningListItem-author"},S()(t)," ",k()(t))),m("span",{class:"WarningListItem-strikes"},n.isHidden()?app.translator.trans("fof-moderator-warnings.forum.warning_list_item.list_item_heading_hidden",{time:R()(n.createdAt()),strikes:n.strikes()||0}):app.translator.trans("fof-moderator-warnings.forum.warning_list_item.list_item_heading",{time:R()(n.createdAt()),strikes:n.strikes()||0})),m("hr",null),m("ul",{className:"WarningListItem-info"},n.post()?m("li",{className:"item-excerpt"},m("h3",{className:"WarningListItem-subtitle"},app.translator.trans("fof-moderator-warnings.forum.warning_list_item.linked_post")),J.component({post:n.post()})):"",m("li",{className:"item-excerpt"},m("h3",{className:"WarningListItem-subtitle"},app.translator.trans("fof-moderator-warnings.forum.warning_list_item.public_comment")),m("p",{class:"WarningListItem-comment"},m.trust(n.public_comment()))),app.session.user.canManageWarnings()&&n.private_comment()?m("li",{className:"item-excerpt"},m("h3",{className:"WarningListItem-subtitle"},app.translator.trans("fof-moderator-warnings.forum.warning_list_item.private_comment")),m("p",{class:"WarningListItem-comment"},m.trust(n.private_comment()))):"")))},r.elementAttrs=function(){var n=this.attrs.warning,t={};return t.className=(t.className||"")+" "+E()({WarningListItem:!0,"WarningListItem--hidden":n.isHidden()}),t},t}(B());const tn=flarum.core.compat["common/helpers/listItems"];var rn=n.n(tn),an=function(n){function t(){return n.apply(this,arguments)||this}v(t,n);var a=t.prototype;return a.oninit=function(t){n.prototype.oninit.call(this,t),this.loading=!0,this.warnings=[],this.user=this.attrs.params.user,this.refresh()},a.view=function(){var n;return this.loading&&(n=M().component({size:"large"})),m("div",{className:"WarningList"},m("h1",{className:"WarningList-warnings"},this.strikeCount()?r().translator.trans("fof-moderator-warnings.forum.warning_list.warnings",{strikes:this.strikeCount()||0}):r().translator.trans("fof-moderator-warnings.forum.warning_list.warnings_no_strikes")),m("div",{class:"Warnings-toolbar"},m("ul",{className:"Warnings-toolbar-action"},rn()(this.actionItems().toArray()))),m("ul",{className:"WarningList-Warnings"},this.warnings.map(function(n){return m("li",{key:n.id(),"data-id":n.id()},nn.component({warning:n}))}),!this.loading&&0===this.warnings.length&&m("label",null,r().translator.trans("fof-moderator-warnings.forum.warning_list.no_warnings"))),m("div",{className:"WarningList-loadMore"},n))},a.actionItems=function(){var n=new(Y());return r().session.user.canManageWarnings()&&n.add("create_warning",m(g(),{className:"Button Button--primary",onclick:this.handleOnClickCreate.bind(this)},r().translator.trans("fof-moderator-warnings.forum.warning_list.add_button"))),n},a.strikeCount=function(){return this.warnings.filter(function(n){return!n.isHidden()}).map(function(n){return n.strikes()}).reduce(function(n,t){return n+t},0)},a.parseResults=function(n){return[].push.apply(this.warnings,n),this.loading=!1,m.redraw(),n},a.refresh=function(){var n=this;return r().store.find("warnings",this.user.id()).catch(function(){}).then(function(t){n.warnings=[],n.parseResults(t)})},a.handleOnClickCreate=function(n){n.preventDefault(),r().modal.show(C,I({callback:this.refresh.bind(this)},this.attrs.params))},t}(B()),on=function(n){function t(){return n.apply(this,arguments)||this}v(t,n);var r=t.prototype;return r.oninit=function(t){n.prototype.oninit.call(this,t),this.loadUser(m.route.param("username"))},r.content=function(){if(app.session.user&&(app.session.user.canViewWarnings()||this.user.id()===app.session.user.id()&&this.user.visibleWarningCount()>0))return m("div",{className:"WarningsUserPage"},an.component({params:{user:this.user,sort:"newest"}}))},t}(A());function sn(){app.routes["user.warnings"]={path:"/u/:username/warnings",component:on},(0,s.extend)(A().prototype,"navItems",function(n){app.session.user&&(app.session.user.canViewWarnings()||this.user.id()===app.session.user.id()&&this.user.visibleWarningCount()>0)&&n.add("warnings",x().component({href:app.route("user.warnings",{username:this.user.slug()}),icon:"fas fa-exclamation-circle"},[app.translator.trans("fof-moderator-warnings.forum.user.warnings"),this.user.visibleWarningCount()>0?m("span",{className:"Button-badge"},this.user.visibleWarningCount()):""]),10)})}const en=flarum.core.compat["common/models/Post"];var mn=n.n(en);const cn=flarum.core.compat["forum/components/CommentPost"];var un=n.n(cn);const ln=flarum.core.compat["common/helpers/icon"];var pn=n.n(ln),fn=function(n){function t(){return n.apply(this,arguments)||this}v(t,n);var r=t.prototype;return r.oninit=function(t){n.prototype.oninit.call(this,t),this.warning=this.attrs.warning},r.view=function(){return m(H(),{className:"WarningPreview",href:app.route("user.warnings",{username:this.warning.warnedUser().username()})},m(nn,{warning:this.warning}))},t}(B()),dn=function(n){function t(){return n.apply(this,arguments)||this}v(t,n);var r=t.prototype;return r.oninit=function(t){n.prototype.oninit.call(this,t),this.warning=this.attrs.warning},r.view=function(){return m("div",{className:"Post-warning"},m("span",{className:"Post-warning-summary"},pn()("fas fa-exclamation-circle"),this.warning.strikes()?app.translator.trans("fof-moderator-warnings.forum.post.warning",{strikes:this.warning.strikes()||0,mod_username:k()(this.warning.addedByUser())}):app.translator.trans("fof-moderator-warnings.forum.post.warning_no_strikes",{mod_username:k()(this.warning.addedByUser())})))},r.oncreate=function(t){var r=this;n.prototype.oncreate.call(this,t);var a,o=this.warning,s=function(){r.$(".Post-warning-preview").removeClass("in").one("transitionend",function(){$(this).hide()})},e=$('<ul class="Dropdown-menu Post-warning-preview fade"/>');this.$().append(e),this.$().children().hover(function(){clearTimeout(a),a=setTimeout(function(){!e.hasClass("in")&&e.is(":visible")||(m.render(e[0],m("li",{"data-id":o.id()},fn.component({warning:o}))),e.show(),setTimeout(function(){return e.off("transitionend").addClass("in")}))},200)},function(){clearTimeout(a),a=setTimeout(s,250)}),$(".Post-warning").find(".Post-warning-summary a").hover(function(){$(".Post-warning").find('[data-number="'+$(this).data("number")+'"]').addClass("active")},function(){$(".Post-warning").find("[data-number]").removeClass("active")})},t}(B()),hn=function(n){function t(){return n.apply(this,arguments)||this}v(t,n);var r=t.prototype;return r.oninit=function(t){n.prototype.oninit.call(this,t),this.post=this.attrs.post},r.view=function(){return m("div",{className:"Post-warning-list"},this.attrs.post.warnings().map(function(n){return dn.component({warning:n})}))},t}(B());const gn=flarum.core.compat["forum/components/Notification"];var wn=function(n){function t(){return n.apply(this,arguments)||this}v(t,n);var r=t.prototype;return r.icon=function(){return"fas fa-exclamation-circle"},r.href=function(){return app.route("user.warnings",{username:app.session.user.username()})},r.content=function(){var n=this.attrs.notification.subject();return n.strikes()?app.translator.trans("fof-moderator-warnings.forum.notifications.warning_text",{mod_username:k()(this.attrs.notification.fromUser()),strikes:n.strikes()||0}):app.translator.trans("fof-moderator-warnings.forum.notifications.warning_no_strikes_text",{mod_username:k()(this.attrs.notification.fromUser())})},t}(n.n(gn)());const vn=flarum.core.compat["common/utils/computed"];var bn=n.n(vn),_n=function(n){function t(){return n.apply(this,arguments)||this}return v(t,n),t}(u());Object.assign(_n.prototype,{id:u().attribute("id"),public_comment:u().attribute("public_comment"),private_comment:u().attribute("private_comment"),strikes:u().attribute("strikes"),createdAt:u().attribute("createdAt",u().transformDate),isHidden:bn()("hiddenAt",function(n){return!!n}),hiddenAt:u().attribute("hiddenAt",u().transformDate),warnedUser:u().hasOne("warnedUser"),hiddenByUser:u().hasOne("hiddenByUser"),addedByUser:u().hasOne("addedByUser"),post:u().hasOne("post")}),r().initializers.add("fof-moderator-warnings",function(n){n.store.models.warnings=_n,i().prototype.canViewWarnings=u().attribute("canViewWarnings"),i().prototype.canManageWarnings=u().attribute("canManageWarnings"),i().prototype.canDeleteWarnings=u().attribute("canDeleteWarnings"),i().prototype.visibleWarningCount=u().attribute("visibleWarningCount"),(0,s.extend)(p(),"moderationControls",function(n,t){r().session.user&&r().session.user.canManageWarnings()&&n.add("warning",m(g(),{icon:"fas fa-exclamation-circle",onclick:function(){return r().modal.show(C,{callback:function(){location.reload()},user:t.user(),post:t})}},r().translator.trans("fof-moderator-warnings.forum.post_controls.warning_button")))}),(0,s.extend)(d(),"moderationControls",function(n,t){r().session.user&&r().session.user.canManageWarnings()&&n.add("warning",m(g(),{icon:"fas fa-exclamation-circle",onclick:function(){return r().modal.show(C,{callback:function(){location.reload()},user:t})}},r().translator.trans("fof-moderator-warnings.forum.post_controls.warning_button")))}),sn(),mn().prototype.warnings=u().hasMany("warnings"),(0,s.extend)(un().prototype,"footerItems",function(n){var t=this.attrs.post;t.warnings()&&n.add("warnings",hn.component({post:t}))}),n.notificationComponents.warning=wn,(0,s.extend)(o().prototype,"notificationTypes",function(t){t.add("warning",{name:"warning",icon:"fas fa-exclamation-circle",label:n.translator.trans("fof-moderator-warnings.forum.settings.warning_notification_label")})})})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map