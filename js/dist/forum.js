(()=>{var n={n:r=>{var t=r&&r.__esModule?()=>r.default:()=>r;return n.d(t,{a:t}),t},d:(r,t)=>{for(var e in t)n.o(t,e)&&!n.o(r,e)&&Object.defineProperty(r,e,{enumerable:!0,get:t[e]})},o:(n,r)=>Object.prototype.hasOwnProperty.call(n,r),r:n=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})}},r={};(()=>{"use strict";n.r(r),n.d(r,{extend:()=>Cn});const t=flarum.reg.get("core","forum/app");var e=n.n(t);const s=flarum.reg.get("core","common/extend"),a=flarum.reg.get("core","forum/utils/PostControls");var o=n.n(a);const i=flarum.reg.get("core","forum/utils/UserControls");var l=n.n(i);const c=flarum.reg.get("core","common/components/Button");var u=n.n(c);const d=flarum.reg.get("core","common/components/Form");var g=n.n(d);const f=flarum.reg.get("core","common/components/FormModal");var p=n.n(f);const h=flarum.reg.get("core","common/helpers/username");var w=n.n(h);const v=flarum.reg.get("core","common/utils/Stream");var b=n.n(v);class _ extends(p()){oninit(n){super.oninit(n),this.publicComment=b()(""),this.privateComment=b()(""),this.strikes=b()(0)}className(){return"WarningsModal Modal--large"}title(){return app.translator.trans("fof-moderator-warnings.forum.warning_modal.heading",{username:w()(this.attrs.user)})}content(){return m("div",{className:"Modal-body"},m(g(),{className:"Form--centered"},m("div",{className:"Form-group"},m("div",null,m("label",null,app.translator.trans("fof-moderator-warnings.forum.warning_modal.strikes_heading"),m("input",{type:"number",className:"FormControl",bidi:this.strikes,min:"0",max:"5"})))),m("div",{className:"Form-group"},m("div",null,m("label",null,app.translator.trans("fof-moderator-warnings.forum.warning_modal.public_comment_heading",{username:w()(this.attrs.user)}),m("textarea",{className:"FormControl",bidi:this.publicComment,required:!0,rows:"6"})))),m("div",{className:"Form-group"},m("div",null,m("label",null,app.translator.trans("fof-moderator-warnings.forum.warning_modal.private_comment_heading",{username:w()(this.attrs.user)}),m("textarea",{className:"FormControl",bidi:this.privateComment,rows:"6"})))),m("div",{className:"Form-group"},m(u(),{className:"Button Button--primary Button--block",type:"submit",loading:this.loading},app.translator.trans("fof-moderator-warnings.forum.warning_modal.submit_button")))))}onsubmit(n){n.preventDefault(),app.alerts.dismiss(this.successAlert),this.loading=!0,this.strikes()||this.strikes(0);const r={userId:this.attrs.user.id(),strikes:this.strikes(),publicComment:this.publicComment(),privateComment:this.privateComment()};this.attrs.post&&(r.relationships={post:this.attrs.post}),app.store.createRecord("warnings").save(r).then(this.hide.bind(this)).then(this.successAlert=app.alerts.show({type:"success"},app.translator.trans("fof-moderator-warnings.forum.warning_modal.confirmation_message"))).then(this.attrs.callback).catch(()=>{})}}flarum.reg.add("fof-moderator-warnings","forum/components/WarningModal",_);const y=flarum.reg.get("core","forum/components/UserPage");var W=n.n(y);const k=flarum.reg.get("core","common/components/LinkButton");var C=n.n(k);function N(n){return N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},N(n)}function P(n,r,t){return(r=function(n){var r=function(n){if("object"!=N(n)||!n)return n;var r=n[Symbol.toPrimitive];if(void 0!==r){var t=r.call(n,"string");if("object"!=N(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(n);return"symbol"==N(r)?r:r+""}(r))in n?Object.defineProperty(n,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[r]=t,n}const x=flarum.reg.get("core","common/Component");var O=n.n(x);const A=flarum.reg.get("core","common/components/LoadingIndicator");var L=n.n(A);const I=flarum.reg.get("core","common/components/Dropdown");var S=n.n(I);const j=flarum.reg.get("core","common/components/Link");var M=n.n(j);const B=flarum.reg.get("core","common/components/Avatar");var U=n.n(B);const D=flarum.reg.get("core","common/helpers/humanTime");var F=n.n(D);const T=flarum.reg.get("core","common/utils/classList");var H=n.n(T);const E=flarum.reg.get("core","forum/components/PostPreview");var R=n.n(E);class V extends(O()){view(){return m("div",{className:"WarningPost"},m("ul",{class:"Dropdown-menu PostPreview-preview fade in"},m("li",null,R().component({post:this.attrs.post}))))}oncreate(n){super.oncreate(n),this.$(".PostPreview-preview").show().css("position","relative")}}flarum.reg.add("fof-moderator-warnings","forum/components/WarningPost",V);const z=flarum.reg.get("core","common/components/Separator");var q=n.n(z);const G=flarum.reg.get("core","common/utils/ItemList");var J=n.n(G);const K={controls(n,r){const t=new(J());return["user","moderation","destructive"].forEach(e=>{const s=this[e+"Controls"](n,r).toArray();s.length&&(s.forEach(n=>t.add(n.itemName,n)),t.add(e+"Separator",q().component()))}),t},userControls:(n,r)=>new(J()),moderationControls:(n,r)=>new(J()),destructiveControls(n,r){const t=new(J());return!n.isHidden()&&app.session.user.canManageWarnings()&&t.add("hide",m(u(),{icon:"far fa-trash-alt",onclick:this.hideAction.bind(n)},app.translator.trans("fof-moderator-warnings.forum.warning_controls.delete_button"))),n.isHidden()&&app.session.user.canManageWarnings()&&t.add("restore",m(u(),{icon:"fas fa-reply",onclick:this.restoreAction.bind(n)},app.translator.trans("fof-moderator-warnings.forum.warning_controls.restore_button"))),n.isHidden()&&app.session.user.canDeleteWarnings()&&t.add("delete",m(u(),{icon:"fas fa-times",onclick:this.deleteAction.bind(n)},app.translator.trans("fof-moderator-warnings.forum.warning_controls.delete_forever_button"))),t},hideAction(){return this.pushAttributes({hiddenAt:new Date,hiddenUser:app.session.user}),this.save({isHidden:!0}).then(()=>m.redraw())},restoreAction(){return this.pushAttributes({hiddenAt:null,hiddenUser:null}),this.save({isHidden:!1}).then(()=>m.redraw())},deleteAction(n){return n&&(n.loading=!0),this.delete().then(()=>{}).catch(()=>{}).then(()=>{n&&(n.loading=!1),location.reload()})}};class Q extends(O()){view(){const{warning:n}=this.attrs,r=n.addedByUser(),t=K.controls(n,this).toArray();return m("div",this.elementAttrs(),t.length?S().component({icon:"fas fa-ellipsis-v",className:"WarningListItem-controls",buttonClassName:"Button Button--icon Button--flat Slidable-underneath Slidable-underneath--right"},t):"",m("div",{className:"WarningListItem-main"},m("h3",{className:"WarningListItem-title"},m(M(),{href:r?app.route.user(r):"#",className:"WarningListItem-author"},m(U(),{user:r})," ",w()(r))),m("span",{class:"WarningListItem-strikes"},n.isHidden()?app.translator.trans("fof-moderator-warnings.forum.warning_list_item.list_item_heading_hidden",{time:F()(n.createdAt()),strikes:n.strikes()||0}):app.translator.trans("fof-moderator-warnings.forum.warning_list_item.list_item_heading",{time:F()(n.createdAt()),strikes:n.strikes()||0})),m("hr",null),m("ul",{className:"WarningListItem-info"},n.post()?m("li",{className:"item-excerpt"},m("h3",{className:"WarningListItem-subtitle"},app.translator.trans("fof-moderator-warnings.forum.warning_list_item.linked_post")),V.component({post:n.post()})):"",m("li",{className:"item-excerpt"},m("h3",{className:"WarningListItem-subtitle"},app.translator.trans("fof-moderator-warnings.forum.warning_list_item.public_comment")),m("p",{class:"WarningListItem-comment"},m.trust(n.publicComment()))),app.session.user.canManageWarnings()&&n.privateComment()?m("li",{className:"item-excerpt"},m("h3",{className:"WarningListItem-subtitle"},app.translator.trans("fof-moderator-warnings.forum.warning_list_item.private_comment")),m("p",{class:"WarningListItem-comment"},m.trust(n.privateComment()))):"")))}elementAttrs(){const{warning:n}=this.attrs,r={};return r.className=(r.className||"")+" "+H()({WarningListItem:!0,"WarningListItem--hidden":n.isHidden()}),r}}flarum.reg.add("fof-moderator-warnings","forum/components/WarningListItem",Q);const X=flarum.reg.get("core","common/helpers/listItems");var Y=n.n(X);function Z(n,r){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(n);r&&(e=e.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,e)}return t}class nn extends(O()){oninit(n){super.oninit(n),this.loading=!0,this.warnings=[],this.user=this.attrs.params.user,this.refresh()}view(){let n;return this.loading&&(n=L().component({size:"large"})),m("div",{className:"WarningList"},m("h1",{className:"WarningList-warnings"},this.strikeCount()?e().translator.trans("fof-moderator-warnings.forum.warning_list.warnings",{strikes:this.strikeCount()||0}):e().translator.trans("fof-moderator-warnings.forum.warning_list.warnings_no_strikes")),m("div",{class:"Warnings-toolbar"},m("ul",{className:"Warnings-toolbar-action"},Y()(this.actionItems().toArray()))),m("ul",{className:"WarningList-Warnings"},this.warnings.map(n=>m("li",{key:n.id(),"data-id":n.id()},Q.component({warning:n}))),!this.loading&&0===this.warnings.length&&m("label",null,e().translator.trans("fof-moderator-warnings.forum.warning_list.no_warnings"))),m("div",{className:"WarningList-loadMore"},n))}actionItems(){const n=new(J());return e().session.user.canManageWarnings()&&n.add("create_warning",m(u(),{className:"Button Button--primary",onclick:this.handleOnClickCreate.bind(this)},e().translator.trans("fof-moderator-warnings.forum.warning_list.add_button"))),n}strikeCount(){return this.warnings.filter(n=>!n.isHidden()).map(n=>n.strikes()).reduce((n,r)=>n+r,0)}parseResults(n){return[].push.apply(this.warnings,n),this.loading=!1,m.redraw(),n}refresh(){return e().store.find("warnings",{filter:{userId:this.user.id()}}).catch(()=>{}).then(n=>{this.warnings=[],this.parseResults(n)})}handleOnClickCreate(n){n.preventDefault(),e().modal.show(_,function(n){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?Z(Object(t),!0).forEach(function(r){P(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Z(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}({callback:this.refresh.bind(this)},this.attrs.params))}}flarum.reg.add("fof-moderator-warnings","forum/components/WarningList",nn);class rn extends(W()){oninit(n){super.oninit(n),this.loadUser(m.route.param("username"))}content(){if(app.session.user&&(app.session.user.canViewWarnings()||this.user.id()===app.session.user.id()&&this.user.visibleWarningCount()>0))return m("div",{className:"WarningsUserPage"},nn.component({params:{user:this.user,sort:"newest"}}))}}flarum.reg.add("fof-moderator-warnings","forum/components/WarningPage",rn);const tn=flarum.reg.get("core","common/Model");var en=n.n(tn);const sn=flarum.reg.get("core","common/models/Post");var an=n.n(sn);const on=flarum.reg.get("core","forum/components/CommentPost");var mn=n.n(on);const ln=flarum.reg.get("core","common/components/Icon");var cn=n.n(ln);class un extends(O()){oninit(n){super.oninit(n),this.warning=this.attrs.warning}view(){return m(M(),{className:"WarningPreview",href:app.route("user.warnings",{username:this.warning.warnedUser().username()})},m(Q,{warning:this.warning}))}}flarum.reg.add("fof-moderator-warnings","forum/components/WarningPreview",un);class dn extends(O()){oninit(n){super.oninit(n),this.warning=this.attrs.warning}view(){return m("div",{className:"Post-warning"},m("span",{className:"Post-warning-summary"},m(cn(),{name:"fas fa-exclamation-circle"}),this.warning.strikes()?app.translator.trans("fof-moderator-warnings.forum.post.warning",{strikes:this.warning.strikes()||0,mod_username:w()(this.warning.addedByUser())}):app.translator.trans("fof-moderator-warnings.forum.post.warning_no_strikes",{mod_username:w()(this.warning.addedByUser())})))}oncreate(n){super.oncreate(n);const r=this.warning;let t;const e=()=>{this.$(".Post-warning-preview").removeClass("in").one("transitionend",function(){$(this).hide()})},s=$('<ul class="Dropdown-menu Post-warning-preview fade"/>');this.$().append(s),this.$().children().hover(function(){clearTimeout(t),t=setTimeout(function(){!s.hasClass("in")&&s.is(":visible")||(m.render(s[0],m("li",{"data-id":r.id()},un.component({warning:r}))),s.show(),setTimeout(()=>s.off("transitionend").addClass("in")))},200)},function(){clearTimeout(t),t=setTimeout(e,250)}),$(".Post-warning").find(".Post-warning-summary a").hover(function(){$(".Post-warning").find('[data-number="'+$(this).data("number")+'"]').addClass("active")},function(){$(".Post-warning").find("[data-number]").removeClass("active")})}}flarum.reg.add("fof-moderator-warnings","forum/components/PostWarning",dn);class gn extends(O()){oninit(n){super.oninit(n),this.post=this.attrs.post}view(){return m("div",{className:"Post-warning-list"},this.attrs.post.warnings().map(n=>dn.component({warning:n})))}}flarum.reg.add("fof-moderator-warnings","forum/components/PostWarningList",gn);const fn=flarum.reg.get("core","common/extenders");var pn=n.n(fn);const hn=flarum.reg.get("core","common/utils/computed");var wn=n.n(hn);class vn extends(en()){publicComment(){return en().attribute("publicComment").call(this)}privateComment(){return en().attribute("privateComment").call(this)}strikes(){return en().attribute("strikes").call(this)}createdAt(){return en().attribute("createdAt",en().transformDate).call(this)}hiddenAt(){return en().attribute("hiddenAt",en().transformDate).call(this)}isHidden(){return wn()("hiddenAt",n=>!!n).call(this)}warnedUser(){return en().hasOne("warnedUser").call(this)}hiddenByUser(){return en().hasOne("hiddenByUser").call(this)}addedByUser(){return en().hasOne("addedByUser").call(this)}post(){return en().hasOne("post").call(this)}}flarum.reg.add("fof-moderator-warnings","forum/model/Warning",vn);const bn=flarum.reg.get("core","common/models/User");var _n=n.n(bn);const yn=flarum.reg.get("core","forum/components/Notification");var Wn=n.n(yn);class kn extends(Wn()){icon(){return"fas fa-exclamation-circle"}href(){const n=e().session.user;return n?e().route("user.warnings",{username:n.username()}):"#"}content(){const n=this.attrs.notification,r=n.subject(),t=n.fromUser();return r.strikes()?e().translator.trans("fof-moderator-warnings.forum.notifications.warning_text",{mod_username:w()(t),strikes:r.strikes()||0}):e().translator.trans("fof-moderator-warnings.forum.notifications.warning_no_strikes_text",{mod_username:w()(t)})}excerpt(){return null}}flarum.reg.add("fof-moderator-warnings","forum/components/WarningNotification",kn);const Cn=[(new(pn().Store)).add("warnings",vn),new(pn().Model)(_n()).attribute("canViewWarnings").attribute("canManageWarnings").attribute("canDeleteWarnings").attribute("visibleWarningCount"),(new(pn().Notification)).add("warning",kn)];e().initializers.add("fof-moderator-warnings",()=>{(0,s.extend)(o(),"moderationControls",function(n,r){e().session.user&&e().session.user.canManageWarnings()&&n.add("warning",m(u(),{icon:"fas fa-exclamation-circle",onclick:()=>e().modal.show(_,{callback:()=>{location.reload()},user:r.user(),post:r})},e().translator.trans("fof-moderator-warnings.forum.post_controls.warning_button")))}),(0,s.extend)(l(),"moderationControls",function(n,r){e().session.user&&e().session.user.canManageWarnings()&&n.add("warning",m(u(),{icon:"fas fa-exclamation-circle",onclick:()=>e().modal.show(_,{callback:()=>{location.reload()},user:r})},e().translator.trans("fof-moderator-warnings.forum.post_controls.warning_button")))}),e().routes["user.warnings"]={path:"/u/:username/warnings",component:rn},(0,s.extend)(W().prototype,"navItems",function(n){e().session.user&&(e().session.user.canViewWarnings()||this.user.id()===e().session.user.id()&&this.user.visibleWarningCount()>0)&&n.add("warnings",C().component({href:e().route("user.warnings",{username:this.user.slug()}),icon:"fas fa-exclamation-circle"},[e().translator.trans("fof-moderator-warnings.forum.user.warnings"),this.user.visibleWarningCount()>0?m("span",{className:"Button-badge"},this.user.visibleWarningCount()):""]),10)}),an().prototype.warnings=en().hasMany("warnings"),(0,s.extend)(mn().prototype,"footerItems",function(n){const r=this.attrs.post;r.warnings()&&n.add("warnings",gn.component({post:r}))}),(0,s.extend)("flarum/forum/components/NotificationGrid","notificationTypes",function(n){n.add("warning",{name:"warning",icon:"fas fa-exclamation-circle",label:e().translator.trans("fof-moderator-warnings.forum.settings.warning_notification_label")})})})})(),module.exports=r})();
//# sourceMappingURL=forum.js.map